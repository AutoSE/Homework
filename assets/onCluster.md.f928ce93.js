import{_ as n,c as a,b as l,a as s,d as o,o as e}from"./app.c68688ac.js";const h=JSON.parse('{"title":"Cluster","description":"","frontmatter":{},"headers":[{"level":2,"title":"Clustering","slug":"clustering","link":"#clustering","children":[]},{"level":2,"title":"Relevance to SE","slug":"relevance-to-se","link":"#relevance-to-se","children":[]},{"level":2,"title":"The Core of Clustering","slug":"the-core-of-clustering","link":"#the-core-of-clustering","children":[]},{"level":2,"title":"Distance (Basic)","slug":"distance-basic","link":"#distance-basic","children":[{"level":3,"title":"K-means","slug":"k-means","link":"#k-means","children":[]}]},{"level":2,"title":"Recursive Bi-Clustering","slug":"recursive-bi-clustering","link":"#recursive-bi-clustering","children":[{"level":3,"title":"KD-Treess","slug":"kd-treess","link":"#kd-treess","children":[]},{"level":3,"title":"Recursive Fastmap (the sampling way)","slug":"recursive-fastmap-the-sampling-way","link":"#recursive-fastmap-the-sampling-way","children":[]},{"level":3,"title":"Random Projections","slug":"random-projections","link":"#random-projections","children":[]}]}],"relativePath":"onCluster.md"}'),p={name:"onCluster.md"},t=s(`<h1 id="cluster" tabindex="-1">Cluster <a class="header-anchor" href="#cluster" aria-hidden="true">#</a></h1><h2 id="clustering" tabindex="-1">Clustering <a class="header-anchor" href="#clustering" aria-hidden="true">#</a></h2><p>&quot;Clustering&quot; means grouping together similar things</p><ul><li>Give goal attributes $Y$ and other attributes $X$ it is typically groupings in $X$ space. <ul><li>Distance calculations in $Y$ space is usually called &quot;domination&quot; (see below)</li></ul></li><li>But as we shall see, clustering in $X$, pls a little sampling in $Y$ can be very useful.</li></ul><h2 id="relevance-to-se" tabindex="-1">Relevance to SE <a class="header-anchor" href="#relevance-to-se" aria-hidden="true">#</a></h2><p>Applications:</p><ul><li>as a runtime checker (cluster the data, then report any new inputs that fall outside the range of the clusters of the test data used to test the system)[^liu]</li><li>as an optimization tool (don&#39;t explore the whole space; instead cluster and run your analysis on many small clusters)[^maj18][^riot]</li><li>as an optimizer in its own right (see below)[^chen]</li><li>as a test generation tool (to partition the input space, then run just a few tests per partition) [^stall]</li><li>as a verification tool to visualize the output space of a system[^davies]</li><li>as a requirements engineering tool (to encourage a fast discussion across the whole space)[^leit] <ul><li>In the summer of 2011 and 2012, I spent two months working on-site at Microsoft Redmond, observing data mining analysts. <ul><li>I observed numerous meetings where Microsoft’s data scientists and business users discussed logs of defect data.</li><li>There was a surprising little inspection of the output of data miners as compared to another process, which we might call <em>fishing</em>.</li><li>In fishing, analysts and users spend much time inspecting and discussing small samples of either raw or exemplary or synthesized project data.</li><li>For example, in <em>data engagement meetings</em>, users debated the implications of data displayed on a screen.</li><li>In this way, users engaged with the data and with each other by monitoring each other’s queries and checking each other’s conclusions.</li></ul></li></ul></li><li>As a privacy tool (why share all the data? why not just cluster and just a few cluster centroids?)[^peters] <ul><li><a href="https://www.ezzoterik.com/papers/15lace2.pdf" target="_blank" rel="noreferrer">Fayola Peters</a> used cluster + contrast to prune, as she passed data around a community.</li><li>For example, in the following, green rows are those nearest the cluster centroids and blue rows are the ones most associated with the last column (bugs/10Kloc).</li><li>Discard things are aren&#39;t blue of green.</li><li>She ended up sharing 20% of the rows and around a third of the columns. 1 - 1/5*1/3 thus offered 93% privacy</li><li>As for the remaining 7% of the data, we ran a mutator that pushed up items up the boundary point between classes (and no further). Bu certain common measures of privacy, that made the 7% space 80% private.</li><li>Net effect 93% + .8*7 = 98.4% private,</li><li>And, FYI, inference on the tiny green+blue region was as effective as inference over all</li></ul></li></ul><p>[^peters]: Peters, Fayola, Tim Menzies, and Lucas Layman.](<a href="https://www.ezzoterik.com/papers/15lace2.pdf" target="_blank" rel="noreferrer">https://www.ezzoterik.com/papers/15lace2.pdf</a>) 2015 IEEE/ACM 37th IEEE International Conference on Software Engineering. Vol. 1. IEEE, 2015.</p><p>[^davies]: Davies, Misty, and Karen Gundy-Burlet. <a href="https://ntrs.nasa.gov/api/citations/20110010856/downloads/20110010856.pdf" target="_blank" rel="noreferrer">&quot;Visualization of Global Sensitivity Analysis Results Based on a Combination of Linearly Dependent and Independent Directions.&quot;</a> AIAA Infotech@ Aerospace 2010. 2010. 3387.</p><p>[^stall]: Dimitri Stallenberg, Mitchell Olsthoorn, and Annibale Panichella. 2022. [Improving test case generation for REST APIs through hierarchical clustering] <a href="https://chinagator.github.io/papers/J5.pdf" target="_blank" rel="noreferrer">https://chinagator.github.io/papers/J5.pdf</a>) In Proceedings of the 36th IEEE/ACM International Conference on Automated Software Engineering (ASE &#39;21). IEEE Press, 117–128. <a href="https://doi.org/10.1109/ASE51524.2021.9678586" target="_blank" rel="noreferrer">https://doi.org/10.1109/ASE51524.2021.9678586</a></p><p>[^maj18]: Suvodeep Majumder, Nikhila Balaji, Katie Brey, Wei Fu, and Tim Menzies. 2018. <a href="https://arxiv.org/pdf/1802.05319.pdf" target="_blank" rel="noreferrer">500+ times faster than deep learning: a case study exploring faster methods for text mining stackoverflow</a>. In Proceedings of the 15th International Conference on Mining Software Repositories (MSR &#39;18). Association for Computing Machinery, New York, NY, USA, 554–563. <a href="https://doi.org/10.1145/3196398.3196424" target="_blank" rel="noreferrer">https://doi.org/10.1145/3196398.3196424</a></p><p>[^leit]: Veerappa, Varsha, and Emmanuel Letier. <a href="http://www0.cs.ucl.ac.uk/staff/e.letier/publications/2011-clusteringSolutions.pdf" target="_blank" rel="noreferrer">&quot;Understanding clusters of optimal solutions in multi-objective decision problems.&quot;</a> 2011 IEEE 19Th international requirements engineering conference. IEEE, 2011.</p><p>[^liu]: Liu, Z., Qin, T., Guan, X., Jiang, H., &amp; Wang, C. (2018). <a href="https://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=8371223" target="_blank" rel="noreferrer">An integrated method for anomaly detection from massive system logs</a> IEEE Access, 6, 30602-30611.</p><p>[^riot]: Jianfeng Chen, Tim Menzies: <a href="https://arxiv.org/pdf/1708.08127.pdf" target="_blank" rel="noreferrer">RIOT: A Stochastic-Based Method for Workflow Scheduling in the Cloud</a> IEEE CLOUD 2018: 318-325</p><p>[^chen]: J. Chen, V. Nair, R. Krishna and T. Menzies, <a href="https://arxiv.org/pdf/1608.07617.pdf" target="_blank" rel="noreferrer">&quot;Sampling” as a Baseline Optimizer for Search-Based Software Engineering,&quot;</a> in IEEE Transactions on Software Engineering, vol. 45, no. 6, pp. 597-614, 1 June 2019, doi: 10.1109/TSE.2018.2790925.</p><h2 id="the-core-of-clustering" tabindex="-1">The Core of Clustering <a class="header-anchor" href="#the-core-of-clustering" aria-hidden="true">#</a></h2><p>Large amounts of data can be approximated by the centroids of a few clusters. Why?</p><ul><li>&quot;In most applications examples are not spread uniformly throughout the instance space, but are concentrated on or near a lower-dimensional manifold. Learners can implicitly take advantage of this lower effective dimension.&quot;<br> -- Pedro Domingoes</li><li>Also, Many rows must be similar to the point of redundancy since</li><li>when we build a model, each part of that model should have support from multiple data points.</li><li>This means that all the rows can be shrunk back to just a few examples.</li></ul><p>For example, here we are clustering 398 examples of cars using the $X$ variables:</p><ul><li>find two distant examples $A,B$</li><li>divide other examples into those closest to $A$ or $B$</li><li>recurse on each half</li><li>As a result, we can approximate 398 examples with just 16.</li></ul><p>This data has three $Y$ variables, acceleration (which we want to maximize), weight (which we want to minimize) and miles per hour (which we want to maximize). We print the mean of these values at the root and at each leaf:</p><ul><li>Note that even though we are not trying to, our clusters do separate good from bad $Y$ values:</li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">398  {:Acc+ 15.6 :Lbs- 2970.4 :Mpg+ 23.8}</span></span>
<span class="line"><span style="color:#A6ACCD;">| 199</span></span>
<span class="line"><span style="color:#A6ACCD;">| | 99</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 49</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 24  {:Acc+ 17.3 :Lbs- 2623.5 :Mpg+ 30.4}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.3 :Lbs- 2693.4 :Mpg+ 29.2}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 50</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 15.8 :Lbs- 2446.1 :Mpg+ 27.2}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.7 :Lbs- 2309.2 :Mpg+ 26.0}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | 100</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 50</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.2 :Lbs- 2362.5 :Mpg+ 32.0}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.4 :Lbs- 2184.1 :Mpg+ 34.8}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 50</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.2 :Lbs- 2185.8 :Mpg+ 29.6} &lt;== best?</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.3 :Lbs- 2179.4 :Mpg+ 26.4}</span></span>
<span class="line"><span style="color:#A6ACCD;">| 199</span></span>
<span class="line"><span style="color:#A6ACCD;">| | 99</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 49</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 24  {:Acc+ 16.6 :Lbs- 2716.9 :Mpg+ 22.5}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.1 :Lbs- 3063.5 :Mpg+ 20.4}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 50</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 17.4 :Lbs- 3104.6 :Mpg+ 21.6}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.3 :Lbs- 3145.6 :Mpg+ 22.0}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | 100</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 50</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 12.4 :Lbs- 4320.5 :Mpg+ 12.4}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 11.3 :Lbs- 4194.2 :Mpg+ 12.8} &lt;== worst</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 50</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 13.7 :Lbs- 4143.1 :Mpg+ 18.0}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 14.4 :Lbs- 3830.2 :Mpg+ 16.4}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Now here&#39;s nearly the same algorithm, but know we run a greedy search over the splits. When splitting on two distance points $A,B$, we peel at the $Y$ values<br> and ignore the worse half.</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">398  {:Acc+ 15.6 :Lbs- 2970.4 :Mpg+ 23.8}</span></span>
<span class="line"><span style="color:#A6ACCD;">| 199</span></span>
<span class="line"><span style="color:#A6ACCD;">| | 100</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 50</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 17.2 :Lbs- 2001.0 :Mpg+ 33.2}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Note that:</p><ul><li>This &quot;clustering&quot; algorithm is now an optimizer since it can isolate the best 25 examples out of the 398</li><li>And it does so after evaluating just 5 examples</li><li>two at the root,</li><li>then for each sub-split, we reuse one of the $A,B$ from the parent (the one that was best)</li></ul><p>(Aside: the leaf node found via our optimizer never appears in the cluster tree. Why?)</p><h1 id="how-to-cluster" tabindex="-1">How to Cluster <a class="header-anchor" href="#how-to-cluster" aria-hidden="true">#</a></h1><h2 id="distance-basic" tabindex="-1">Distance (Basic) <a class="header-anchor" href="#distance-basic" aria-hidden="true">#</a></h2><p>Here is Aha&#39;s instance-based distance algorithm, <a href="https://link.springer.com/content/pdf/10.1007/BF00153759.pdf" target="_blank" rel="noreferrer">section 2.4</a>.</p><p>(Note: slow. Ungood for large dimensional spaces. We&#39;ll fix that below.)</p><p>L-norm (L2):</p><ul><li>D= (∑ (Δ(x,y))<sup>p</sup>))<sup>1/p</sup></li><li>euclidean : p=2</li></ul><p>But what is Δ ?</p><ul><li>Δ Symbols: <ul><li>return 0 if x == y else 1</li></ul></li><li>Δ Numbers: <ul><li>x - y</li><li>to make numbers fair with symbols, normalize x,y 0,1 using (x-min)/(max-min)</li></ul></li></ul><p>What about missing values:</p><ul><li>assume worst case</li><li>if both unknown, assume δ = 1</li><li>if one symbol missing, assume δ = 1</li><li>if one number missing: <ul><li>let x,y be unknown, known</li><li>y = normalize(y)</li><li>x = 0 if y &gt; 0.5 else 1</li><li>Δ = (x-y)</li></ul></li></ul><p>In the following recall that <code>DaATA</code> keeps column headers separately for the <code>i.cols.x</code> (independent) columns and the <code>i.cols.y</code> (dependent) columns.</p><div class="language-lua"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">DATA</span><span style="color:#A6ACCD;">.</span><span style="color:#82AAFF;">dist</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">row1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">row2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">cols</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">      </span><span style="color:#A6ACCD;font-style:italic;">n</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">d</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">--&gt; n; returns 0..1 distance \`row1\` to \`row2\`</span></span>
<span class="line"><span style="color:#A6ACCD;">  n,d </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> _,col </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">pairs</span><span style="color:#A6ACCD;">(cols </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> i.</span><span style="color:#FFCB6B;">cols</span><span style="color:#A6ACCD;">.</span><span style="color:#FFCB6B;">x</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;font-style:italic;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">    n </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> n </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">    d </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> d </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">col</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">dist</span><span style="color:#A6ACCD;">(row1.</span><span style="color:#FFCB6B;">cells</span><span style="color:#A6ACCD;">[col.</span><span style="color:#FFCB6B;">at</span><span style="color:#A6ACCD;">], row2.</span><span style="color:#FFCB6B;">cells</span><span style="color:#A6ACCD;">[col.</span><span style="color:#FFCB6B;">at</span><span style="color:#A6ACCD;">])</span><span style="color:#89DDFF;">^</span><span style="color:#A6ACCD;">the.</span><span style="color:#FFCB6B;">p</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> (d</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">n)</span><span style="color:#89DDFF;">^</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">the.</span><span style="color:#FFCB6B;">p</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SYM</span><span style="color:#A6ACCD;">.</span><span style="color:#82AAFF;">dist</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">s1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">s2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> s1</span><span style="color:#89DDFF;">==</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">?</span><span style="color:#89DDFF;">&quot; </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> s2</span><span style="color:#89DDFF;">==</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">?</span><span style="color:#89DDFF;">&quot; </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> (s1</span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;">s2) </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">end</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">NUM</span><span style="color:#A6ACCD;">.</span><span style="color:#82AAFF;">dist</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">n1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">n2</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> n1</span><span style="color:#89DDFF;">==</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">?</span><span style="color:#89DDFF;">&quot; </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> n2</span><span style="color:#89DDFF;">==</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">?</span><span style="color:#89DDFF;">&quot; </span><span style="color:#89DDFF;font-style:italic;">then</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">-- here&#39;s the AHA assumption (assume the max)</span></span>
<span class="line"><span style="color:#A6ACCD;">  n1,n2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">i</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">norm</span><span style="color:#A6ACCD;">(n1), </span><span style="color:#FFCB6B;">i</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">norm</span><span style="color:#A6ACCD;">(n2)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> n1</span><span style="color:#89DDFF;">==</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">?</span><span style="color:#89DDFF;">&quot; </span><span style="color:#89DDFF;font-style:italic;">then</span><span style="color:#A6ACCD;"> n1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> n2</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">.5 </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">-- here&#39;s the AHA assumption (assume the max)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> n2</span><span style="color:#89DDFF;">==</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">?</span><span style="color:#89DDFF;">&quot; </span><span style="color:#89DDFF;font-style:italic;">then</span><span style="color:#A6ACCD;"> n2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> n1</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">.5 </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">-- here&#39;s the AHA assumption (assume the max)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">math.abs</span><span style="color:#A6ACCD;">(n1 </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> n2) </span><span style="color:#89DDFF;font-style:italic;">end</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">NUM</span><span style="color:#A6ACCD;">.</span><span style="color:#82AAFF;">norm</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">n</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> n </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">?</span><span style="color:#89DDFF;">&quot; </span><span style="color:#89DDFF;">and</span><span style="color:#A6ACCD;"> n  </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> (n </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> i.</span><span style="color:#FFCB6B;">lo</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">(i.</span><span style="color:#FFCB6B;">hi</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> i.</span><span style="color:#FFCB6B;">lo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1E-32</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span></code></pre></div><p>With the above, we can sort other rows by their distance to <code>row1</code>:</p><div class="language-lua"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">DATA</span><span style="color:#A6ACCD;">.</span><span style="color:#82AAFF;">around</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">row1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">rows</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">cols</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">--&gt; t; sort other \`rows\` by distance to \`row\`</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sort</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">map</span><span style="color:#A6ACCD;">(rows </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> i.</span><span style="color:#FFCB6B;">rows</span><span style="color:#A6ACCD;">, </span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">row2</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> {row</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">row2, dist</span><span style="color:#89DDFF;">=</span><span style="color:#FFCB6B;">i</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">dist</span><span style="color:#A6ACCD;">(row1,row2,cols)} </span><span style="color:#89DDFF;font-style:italic;">end</span><span style="color:#A6ACCD;">),</span><span style="color:#82AAFF;">lt</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span></code></pre></div><p>In the above, <code>sort</code> is a table sort function that controls the sorting via a second sorting function. In this case, the secondary function is <code>lt</code> which is a function that returns a function that sorts items ascending on some argument:</p><div class="language-lua"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">lt</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">x</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">--&gt; fun;  return a function that sorts ascending on \`x\`</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> a[x] </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> b[x] </span><span style="color:#89DDFF;font-style:italic;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sort</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">t</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">fun</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">--&gt; t; return \`t\`,  sorted by \`fun\` (default= \`&lt;\`)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">table.sort</span><span style="color:#A6ACCD;">(t,fun); </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> t </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span></code></pre></div><h3 id="k-means" tabindex="-1">K-means <a class="header-anchor" href="#k-means" aria-hidden="true">#</a></h3><img src="https://dashee87.github.io/images/kmeans.gif" width="600" align="right"><p>k-means:</p><ul><li>pick $k$ random points</li><li>labeling everyone by their closest $k$</li><li>move $k$ to mean value of all points with same label</li></ul><p>E.g. <a href="https://www.eecs.tufts.edu/~dsculley/papers/fastkmeans.pdf" target="_blank" rel="noreferrer">mini-batch k-means</a></p><ul><li>Pick first 20 examples (at random) as <em>controids</em></li><li>for everything else, run through in batches of size (say 500,2000,etc) <ul><li>mark each item with its nearest centroid</li><li>between batch B and B+1, move centroid towards its marked examples <ul><li>&quot;n&quot; stores how often this centroid has been picked by new data</li><li>Each item &quot;pulls&quot; its centroid attribute &quot;c&quot; towards its own attribute &quot;x&quot; by an amount weighted $c = (1-1/n)*c + x/n$.</li><li>Note that when &quot;n&quot; is large, &quot;c&quot; barely moves at all.</li></ul></li></ul></li></ul><h2 id="recursive-bi-clustering" tabindex="-1">Recursive Bi-Clustering <a class="header-anchor" href="#recursive-bi-clustering" aria-hidden="true">#</a></h2><p>e.g. recursive k-means with k=2.</p><p>But there are many more:</p><h3 id="kd-treess" tabindex="-1">KD-Treess <a class="header-anchor" href="#kd-treess" aria-hidden="true">#</a></h3><ul><li>Look at all the attributes</li><li>Findthe one with the greatest diversity</li><li>Split on its central point (e.g. mean, median, mode)</li><li>Recurse on both halves.</li></ul><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> collections </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> namedtuple</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> operator </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> itemgetter</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> pprint </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> pformat</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Node</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">namedtuple</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Node</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">location left_child right_child</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">__repr__</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">pformat</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">tuple</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">kdtree</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">point_list</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">depth</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> point_list</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    k </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">point_list</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># assumes all points have the same dimension</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># Select axis based on depth so that axis cycles through all valid values</span></span>
<span class="line"><span style="color:#A6ACCD;">    axis </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> depth </span><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;"> k</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># Sort point list by axis and choose median as pivot element</span></span>
<span class="line"><span style="color:#A6ACCD;">    point_list</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sort</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">key</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">itemgetter</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">axis</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    median </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">point_list</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># Create node and construct subtrees</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Node</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">location</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">point_list</span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">median</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">left_child</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">kdtree</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">point_list</span><span style="color:#89DDFF;">[:</span><span style="color:#82AAFF;">median</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> depth </span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">right_child</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">kdtree</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">point_list</span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">median </span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">1</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">:],</span><span style="color:#82AAFF;"> depth </span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span><span style="color:#676E95;font-style:italic;">Example usage</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    point_list </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[(</span><span style="color:#F78C6C;">7</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">9</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">7</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">8</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">)]</span></span>
<span class="line"><span style="color:#A6ACCD;">    tree </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">kdtree</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">point_list</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">tree</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><p>Curse of dimensionality:</p><ul><li>Each split halves the training data size</li><li>Pretty soon, run of data. <ul><li>As a general rule, if the dimensionality is $k$, the number of points in the data, $n$, should be $2^k$. <ul><li>So, theoretically, 20 attributes needs a million rows.</li><li>Strange... we often achieve competency on much smaller data sets.</li></ul></li></ul></li></ul><h3 id="recursive-fastmap-the-sampling-way" tabindex="-1">Recursive Fastmap (the sampling way) <a class="header-anchor" href="#recursive-fastmap-the-sampling-way" aria-hidden="true">#</a></h3><p>&quot;Fastmap&quot; belongs to a class of approximation algorithms to principal component analysis (PCA).</p><ul><li>Eigenvectors of the correlation matrix.</li><li>e.g. at image on right, what is the dimension that best models the data? <ul><li>maybe not the $x,y$ dimensions but the direction of that big arrow <ul><li>which points along the direction of greatest variance. <ul><li>and the 2nd component is the little arrow at right-angles to the first principal arrow.</li></ul></li></ul></li></ul></li></ul>`,61),c=o("br",{clear:"all"},null,-1),r=s(`<div class="language-lua"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cosine</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">c</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">    </span><span style="color:#A6ACCD;font-style:italic;">x1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">x2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">y</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">  x1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (a</span><span style="color:#89DDFF;">^</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> c</span><span style="color:#89DDFF;">^</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> b</span><span style="color:#89DDFF;">^</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">c)</span></span>
<span class="line"><span style="color:#A6ACCD;">  x2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">math.max</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#82AAFF;">math.min</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, x1)) </span></span>
<span class="line"><span style="color:#A6ACCD;">  y  </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> (a</span><span style="color:#89DDFF;">^</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> x2</span><span style="color:#89DDFF;">^</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">^</span><span style="color:#A6ACCD;">.5</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> x2, y </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span></code></pre></div><p>Project every point to a line connecting two distance items.</p><div class="language-lua"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">DATA</span><span style="color:#A6ACCD;">.</span><span style="color:#82AAFF;">half</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">rows</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">cols</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">above</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">--&gt; t,t,row,row,row,n; divides data using 2 far points</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">local</span><span style="color:#A6ACCD;"> A,B,left,right,c,dist,mid,some,project</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">project</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">row</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> {row</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">row, dist</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">cosine</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">dist</span><span style="color:#A6ACCD;">(row,A), </span><span style="color:#82AAFF;">dist</span><span style="color:#A6ACCD;">(row,B), c)} </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">dist</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">row1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">row2</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">i</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">dist</span><span style="color:#A6ACCD;">(row1,row2,cols) </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"><span style="color:#A6ACCD;">  rows </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> rows </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> i.</span><span style="color:#FFCB6B;">rows</span></span>
<span class="line"><span style="color:#A6ACCD;">  some </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">many</span><span style="color:#A6ACCD;">(rows,the.</span><span style="color:#FFCB6B;">Sample</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  A    </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> above </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">any</span><span style="color:#A6ACCD;">(some)  </span><span style="color:#676E95;font-style:italic;">-- if a parent found a distant point, use that</span></span>
<span class="line"><span style="color:#A6ACCD;">  B    </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">i</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">around</span><span style="color:#A6ACCD;">(A,some)[(the.</span><span style="color:#FFCB6B;">Far</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">#</span><span style="color:#A6ACCD;">rows)</span><span style="color:#89DDFF;">//</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">].</span><span style="color:#FFCB6B;">row</span></span>
<span class="line"><span style="color:#A6ACCD;">  c    </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">dist</span><span style="color:#A6ACCD;">(A,B)</span></span>
<span class="line"><span style="color:#A6ACCD;">  left, right </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> {}, {}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> n,tmp </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">pairs</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">sort</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">map</span><span style="color:#A6ACCD;">(rows, project), </span><span style="color:#82AAFF;">lt</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)) </span><span style="color:#89DDFF;font-style:italic;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;">   n </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">#</span><span style="color:#A6ACCD;">rows</span><span style="color:#89DDFF;">//</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">then</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">push</span><span style="color:#A6ACCD;">(left,  tmp.</span><span style="color:#FFCB6B;">row</span><span style="color:#A6ACCD;">); mid </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> tmp.</span><span style="color:#FFCB6B;">row</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">push</span><span style="color:#A6ACCD;">(right, tmp.</span><span style="color:#FFCB6B;">row</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;font-style:italic;">end</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> left, right, A, B, mid, c </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span></code></pre></div><p>Once we can divide some data in two, then recursive clustering is just recursive division.</p><div class="language-lua"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">DATA</span><span style="color:#A6ACCD;">.</span><span style="color:#82AAFF;">cluster</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">rows</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">min</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">cols</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">above</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">--&gt; t; returns \`rows\`, recursively halved</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">local</span><span style="color:#A6ACCD;"> node,left,right,A,B,mid</span></span>
<span class="line"><span style="color:#A6ACCD;">  rows </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> rows </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> i.</span><span style="color:#FFCB6B;">rows</span></span>
<span class="line"><span style="color:#A6ACCD;">  min  </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> min </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">#</span><span style="color:#A6ACCD;">rows)</span><span style="color:#89DDFF;">^</span><span style="color:#A6ACCD;">the.</span><span style="color:#FFCB6B;">min</span></span>
<span class="line"><span style="color:#A6ACCD;">  cols </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> cols </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> i.</span><span style="color:#FFCB6B;">cols</span><span style="color:#A6ACCD;">.</span><span style="color:#FFCB6B;">x</span></span>
<span class="line"><span style="color:#A6ACCD;">  node </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> {data</span><span style="color:#89DDFF;">=</span><span style="color:#FFCB6B;">i</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">clone</span><span style="color:#A6ACCD;">(rows)} </span><span style="color:#676E95;font-style:italic;">--xxx cloning</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">#</span><span style="color:#A6ACCD;">rows </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">min </span><span style="color:#89DDFF;font-style:italic;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">    left, right, node.</span><span style="color:#FFCB6B;">A</span><span style="color:#A6ACCD;">, node.</span><span style="color:#FFCB6B;">B</span><span style="color:#A6ACCD;">, node.</span><span style="color:#FFCB6B;">mid</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">i</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">half</span><span style="color:#A6ACCD;">(rows,cols,above)</span></span>
<span class="line"><span style="color:#A6ACCD;">    node.</span><span style="color:#FFCB6B;">left</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">i</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">cluster</span><span style="color:#A6ACCD;">(left,  min, cols, node.</span><span style="color:#FFCB6B;">A</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    node.</span><span style="color:#FFCB6B;">right</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">i</span><span style="color:#A6ACCD;">:</span><span style="color:#82AAFF;">cluster</span><span style="color:#A6ACCD;">(right, min, cols, node.</span><span style="color:#FFCB6B;">B</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> node </span><span style="color:#89DDFF;font-style:italic;">end</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>Which, just to remind us, gives us this:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">398  {:Acc+ 15.6 :Lbs- 2970.4 :Mpg+ 23.8}</span></span>
<span class="line"><span style="color:#A6ACCD;">| 199</span></span>
<span class="line"><span style="color:#A6ACCD;">| | 99</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 49</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 24  {:Acc+ 17.3 :Lbs- 2623.5 :Mpg+ 30.4}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.3 :Lbs- 2693.4 :Mpg+ 29.2}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 50</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 15.8 :Lbs- 2446.1 :Mpg+ 27.2}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.7 :Lbs- 2309.2 :Mpg+ 26.0}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | 100</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 50</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.2 :Lbs- 2362.5 :Mpg+ 32.0}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.4 :Lbs- 2184.1 :Mpg+ 34.8}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 50</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.2 :Lbs- 2185.8 :Mpg+ 29.6}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.3 :Lbs- 2179.4 :Mpg+ 26.4}</span></span>
<span class="line"><span style="color:#A6ACCD;">| 199</span></span>
<span class="line"><span style="color:#A6ACCD;">| | 99</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 49</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 24  {:Acc+ 16.6 :Lbs- 2716.9 :Mpg+ 22.5}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.1 :Lbs- 3063.5 :Mpg+ 20.4}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 50</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 17.4 :Lbs- 3104.6 :Mpg+ 21.6}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 16.3 :Lbs- 3145.6 :Mpg+ 22.0}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | 100</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 50</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 12.4 :Lbs- 4320.5 :Mpg+ 12.4}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 11.3 :Lbs- 4194.2 :Mpg+ 12.8}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | 50</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 13.7 :Lbs- 4143.1 :Mpg+ 18.0}</span></span>
<span class="line"><span style="color:#A6ACCD;">| | | | 25  {:Acc+ 14.4 :Lbs- 3830.2 :Mpg+ 16.4}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h3 id="random-projections" tabindex="-1">Random Projections <a class="header-anchor" href="#random-projections" aria-hidden="true">#</a></h3><p><img src="https://ars.els-cdn.com/content/image/1-s2.0-S0031320315003945-gr2.jpg" alt=""></p><ul><li>Method one: Guassian random projections <ul><li>Matrix = rows * cols</li><li>Matrix A,B</li><li>A = m × n</li><li>B = n × p</li><li>C = A*B = m x p</li><li>So we can reduce n=1000 cols in matrix A to p=30 cols in C via a matrix <ul><li>1000 row by 30 cols</li></ul></li><li>Initialize B by filling each column with a random number pulled from a normal bell curve</li><li>Only works if all the data is numeric</li><li>Requires all the data in RAM (bad for big data sets)</li></ul></li><li>Method two: LSH: locality sensitivity hashing <ul><li>Find a way to get an approximate position for a row, in a reduced space <ul><li>e.g. repeat d times <ul><li>Find two distant (*) &quot;pivots&quot; = (p,o) <ul><li>Pick, say, 30 rows at random then find within them, the most distant rows</li></ul></li><li>the i-th dimension: <ul><li>this row&#39;s d.i = 0 if (row closer to p than o) else 1</li></ul></li></ul></li><li>repeat d=log(sqrt(N))+1 pivots to get d random projectsion</li></ul></li><li>If you want not 0,1 on each dimension but a continuous number then: <ul><li>given pivots (A,B) separated by &quot;c&quot;</li><li>a = dist(row,A)</li><li>b = dist(row,B)</li><li>this row&#39;s d.x = (a^2 + c^2 - b^2) / (2c) <ul><li>Cosine rule</li></ul></li></ul></li></ul></li></ul>`,10);function i(y,A,D,C,F,u){return e(),a("div",null,[t,c,l(" We can simplify PCA from polynominal to near-linear time with FASTMAP. Once we know distance, then we project things in $N$ dimensions down to one dimension (being a line between 2 distant points). "),r])}const f=n(p,[["render",i]]);export{h as __pageData,f as default};
